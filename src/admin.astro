---
import template from "virtual:astro-decap-cms/template";

// let module;
// if (template) {
//   import(template)
//     .then((mod) => {
//       module = mod;
//       // You can now use the imported module
//     })
//     .catch((err) => {
//       console.error('Failed to load module:', err);
//     });
// }
// console.log(module)

let scriptContent = '';

if (template) {
  const fetchScript = async () => {
    try {
      const response = await fetch(template);
      if (!response.ok) {
        throw new Error(`Failed to fetch ${template}: ${response.status}`);
      }
      return await response.text();
    } catch (error) {
      console.error('Error fetching script:', error);
      return '';
    }
  };

  scriptContent = await fetchScript();
}

console.log(scriptContent)
---
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="robots" content="noindex" />
		<link href="/admin/config.yml" type="text/yaml" rel="cms-config-url" />
		<title>Content Manager</title>
	</head>
	<body>
		<script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"
		></script>
		<script>
			import styles from "virtual:astro-decap-cms/styles";
			styles.forEach((style) => {
				const script = document.createElement("script");
				script.textContent = `CMS.registerPreviewStyle('${style}');`;
				document.body.appendChild(script);
			});
		</script>
		{console.log("template in body",template)}
		<!-- <script src={template}></script>
		
		-->


		<script >
			import template from "virtual:astro-decap-cms/template";
			if (template) {
			  fetch(template)
				.then(response => response.text())
				.then(scriptText => {
				  const script = document.createElement('script');
				  script.textContent = scriptText;
				  document.body.appendChild(script);
				})
				.catch(error => {
				  console.error('Error loading script:', error);
				});
			}
		  </script>
		<!-- <script>
			import template from "virtual:astro-decap-cms/template";
			if (template) {
				const script = document.createElement("script");
				script.src = template;
				document.body.appendChild(script);
			}
		</script> -->
	</body>
</html>
